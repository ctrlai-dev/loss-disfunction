---
const { code, theme = "dark" } = Astro.props;
---

<div class="mermaid">{code}</div>
<script is:inline type="module" define:vars={{ theme }}>
  const mod = await import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs');
  const mermaid = mod.default || mod;
  mermaid.initialize({ startOnLoad: true, theme });
  // In case Astro swaps pages, ensure diagrams re-run
  const rerender = () => mermaid.run();
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', rerender, { once: true });
  } else {
    rerender();
  }
  window.addEventListener('astro:after-swap', rerender);
</script>


