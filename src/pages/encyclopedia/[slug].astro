---
import AppShell from "@/layouts/AppShell.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("universe");
  return entries.map((e) => ({ params: { slug: e.slug } }));
}

const { slug } = Astro.params;
const entry = (await getCollection("universe")).find(e => e.slug === slug) as CollectionEntry<"universe">;
if (!entry) throw new Error("Entry not found: " + slug);

const related = (await getCollection("universe")).filter(e => entry.data.related?.includes(e.slug));
---
<AppShell title={entry.data.title} sidebar={true}>
  <article class="prose prose-invert max-w-none">
    <h1>{entry.data.title}</h1>
    <p class="opacity-80">{entry.data.summary}</p>
    <slot />
    {Astro.content}
  </article>

  {related.length ? (
    <section class="mt-8">
      <h2 class="text-lg font-semibold mb-2">Related</h2>
      <ul class="list-disc list-inside opacity-90">
        {related.map(r => <li><a href={`/encyclopedia/${r.slug}`}>{r.data.title}</a></li>)}
      </ul>
    </section>
  ) : null}
</AppShell>


