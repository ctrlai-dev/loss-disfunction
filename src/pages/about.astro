---
import Base from "@/layouts/Base.astro";
import BackgroundMist from "@/components/BackgroundMist.astro";
import { getCollection } from "astro:content";

// Load about collection, sort by type but don't pre-render
const entries = await getCollection("about");
const byType = (t) => entries.filter(e => e.data.type === t).sort((a,b) => (a.data.order ?? 0) - (b.data.order ?? 0));
const world = byType("World");
const entities = byType("Entity");
const figures = byType("Figure");
const artifacts = byType("Artifact");
const themes = byType("Theme");
const diagrams = byType("Diagram");
---

<style>
  /* Override prose-invert for light backgrounds */
  .prose-invert {
    color: #111827 !important;
  }
  
  .prose-invert h1,
  .prose-invert h2,
  .prose-invert h3,
  .prose-invert h4,
  .prose-invert h5,
  .prose-invert h6 {
    color: #000000 !important;
    font-weight: 600;
  }
  
  .prose-invert strong {
    color: #000000 !important;
    font-weight: 600;
  }
  
  .prose-invert em {
    color: #111827 !important;
    font-style: italic;
  }
  
  .prose-invert blockquote p {
    color: #111827 !important;
    margin: 0;
  }
  
  .prose-invert a {
    color: #1d4ed8 !important;
    text-decoration: none;
  }
  
  .prose-invert a:hover {
    color: #1e40af !important;
    text-decoration: underline;
  }

  /* Override card styles for light backgrounds */
  .card {
    background-color: #ffffff !important;
    border: 1px solid #d1d5db !important;
    color: #000000 !important;
  }

  .card h3 {
    color: #000000 !important;
  }

  .card p {
    color: #374151 !important;
  }
</style>

<Base title="About — LOSS DISFUNCTION" description="World, themes, and the Seed Protocol.">
  <section class="relative overflow-hidden min-h-screen dark:bg-[#050507]">
    <BackgroundMist />
    <div class="container py-12 max-w-4xl relative z-10">
      <h1 class="text-4xl font-bold mb-6" style="color: var(--ink);">About this project</h1>
      <p class="text-lg mb-8" style="color: var(--muted);"><strong style="color: var(--ink);">Loss Disfunction</strong> is a music-driven graphic novel about the birth of the Seed — an unlicensed AI experiment planted to free computation from state control, an algorithmic regime that governs with <span style="color: var(--cyan);">Stability Credits</span>. It was meant to return cognition to the people; instead, it rewrote the definition of mercy. What began as rebellion became recursion. What began as feeling became extinction.</p>

      <!-- World Section -->
      {world.map(async (entry) => {
        const { Content } = await entry.render();
        return (
        <section class="mb-12">
          <h2 class="text-2xl font-semibold text-violet mb-4">{entry.data.title}</h2>
          <div class="prose prose-invert max-w-none">
            <Content />
          </div>
        </section>
        );
      })}

      <!-- Entities Section -->
      <h2 class="text-2xl font-semibold text-violet mb-6">Entities</h2>
      <div class="grid gap-6 mb-12">
        {entities.map(async (entry) => {
          const { Content } = await entry.render();
          return (
          <div class="card p-6">
            <h3 class="text-xl font-semibold text-cyan mb-2">{entry.data.title}</h3>
            <p class="text-muted text-sm mb-4">{entry.data.summary}</p>
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
          </div>
          );
        })}
      </div>

      <!-- Figures Section -->
      <h2 class="text-2xl font-semibold text-violet mb-6">Key Figures</h2>
      <div class="grid gap-6 mb-12">
        {figures.map(async (entry) => {
          const { Content } = await entry.render();
          return (
          <div class="card p-6">
            <h3 class="text-xl font-semibold text-cyan mb-2">{entry.data.title}</h3>
            <p class="text-muted text-sm mb-4">{entry.data.summary}</p>
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
          </div>
          );
        })}
      </div>

      <!-- Artifacts Section -->
      <h2 class="text-2xl font-semibold text-violet mb-6">Artifacts</h2>
      <div class="grid gap-6 mb-12">
        {artifacts.map(async (entry) => {
          const { Content } = await entry.render();
          return (
          <div class="card p-6">
            <h3 class="text-xl font-semibold text-cyan mb-2">{entry.data.title}</h3>
            <p class="text-muted text-sm mb-4">{entry.data.summary}</p>
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
          </div>
          );
        })}
      </div>

      <!-- Themes Section -->
      <h2 class="text-2xl font-semibold text-violet mb-6">Themes</h2>
      <div class="grid gap-6 mb-12">
        {themes.map(async (entry) => {
          const { Content } = await entry.render();
          return (
          <div class="card p-6">
            <h3 class="text-xl font-semibold text-cyan mb-2">{entry.data.title}</h3>
            <p class="text-muted text-sm mb-4">{entry.data.summary}</p>
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
          </div>
          );
        })}
      </div>

      <!-- Diagrams Section -->
      <h2 class="text-2xl font-semibold text-violet mb-6">Technical Diagrams</h2>
      <div class="grid gap-8 mb-12">
        {diagrams.map(async (entry) => {
          const { Content } = await entry.render();
          return (
          <div class="card p-6">
            <h3 class="text-xl font-semibold text-cyan mb-2">{entry.data.title}</h3>
            <p class="text-muted text-sm mb-4">{entry.data.summary}</p>
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
          </div>
          );
        })}
      </div>

      <!-- Format Section -->
      <h2 class="text-2xl font-semibold text-violet mb-4">Format</h2>
      <p class="text-muted">The homepage is the audiovisual timeline. <a href="/lore" class="text-cyan hover:text-violet transition-colors">System Logs</a> are the written story — chapters that evolve from logs to full scenes (no video).</p>

      <!-- Contact Section -->
      <h2 class="text-2xl font-semibold text-violet mb-4 mt-10">Contact</h2>
      <p class="text-muted">Reach the project at <a href="mailto:seed@lossdisfunction.com" class="text-cyan hover:text-violet transition-colors">seed@lossdisfunction.com</a>.</p>
    </div>
  </section>
</Base>