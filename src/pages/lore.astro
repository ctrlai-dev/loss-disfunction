---
import Base from "@/layouts/Base.astro";
import { getCollection } from "astro:content";
import BackgroundMist from "@/components/BackgroundMist.astro";
// Only load logs collection, sort but don't pre-render
const logs = (await getCollection("logs")).sort((a,b)=>a.data.index-b.data.index);
---
<Base title="System Logs — LOSS DISFUNCTION">
  <section class="relative overflow-hidden min-h-screen">
    <BackgroundMist />
    <div class="container py-12 max-w-4xl relative z-10">
    <div class="mb-12">
      <h1 class="text-4xl font-bold page-h1 mb-4">System Logs</h1>
      <p class="text-muted text-lg">Fragments of the Seed's evolution — ordered 000 → 008.</p>
    </div>
    
    <div class="space-y-12">
      {logs.map(async (entry) => {
        const { Content } = await entry.render();
        return (
        <section id={`log-${String(entry.data.index).padStart(3,"0")}`} class="card p-8">
          <div class="mb-6">
            <h2 class="text-2xl font-bold text-cyan mb-2 tracking-wide">
              {entry.data.id}: {entry.data.title}
            </h2>
            <div class="flex flex-wrap items-center gap-2 mb-2">
              {entry.data.status && (
                <span class={`badge ${entry.data.status === "Declassified" ? "bg-emerald-900/30 text-emerald-300 border-emerald-700/50" : entry.data.status === "Restricted" ? "bg-rose-900/30 text-rose-300 border-rose-700/50" : entry.data.status === "Corrupted" ? "bg-red-900/30 text-red-300 border-red-700/50" : entry.data.status === "Recovered" ? "bg-blue-900/30 text-blue-300 border-blue-700/50" : "bg-amber-900/30 text-amber-300 border-amber-700/50"}`}>
                  {entry.data.status}
                </span>
              )}
              {entry.data.perspective && (
                <span class="badge bg-violet-900/30 text-violet-300 border-violet-700/50">
                  {entry.data.perspective}
                </span>
              )}
              {entry.data.author && (
                <span class="badge bg-cyan-900/30 text-cyan-300 border-cyan-700/50">
                  {entry.data.author}
                </span>
              )}
            </div>
            {entry.data.scene && (
              <p class="text-violet text-sm font-mono">Scene: {entry.data.scene}</p>
            )}
            {entry.data.characters && (
              <p class="text-muted text-sm font-mono">Characters: {entry.data.characters.join(", ")}</p>
            )}
            {entry.data.summary && (
              <p class="text-muted text-sm italic mt-2">{entry.data.summary}</p>
            )}
          </div>
          <div class="prose prose-invert max-w-none">
            <Content />
          </div>
        </section>
        );
      })}
    </div>
    </div>
  </section>
</Base>
